<p>正規表現でちょっと困ったので、メモ程度に書いておきます。</p>
<h2 id="-">やりたいこと</h2>
<p>HTMLファイルの中の一部のHTMLを探し、その一部のHTMLタグだけをエスケープ文字に置き換えたい<br>(すんごい需要なさそう)</p>
<p>自分はmarkdownで記事を書き、それをHTML出力した後に自作の変換コードを使って自分用のHTMLタグに置き換えているのですが、その時にHTML関連の記事を書くとコードブロック内にあるHTMLタグを置き換える必要がありました。<br>それを解決したいなーと思ったら意外と手間取りました・・・</p>
<h2 id="-">解決</h2>
<p>gsubのみで出来るかなーと思ったのですが、色々やっても自分は出来なかったのでまずmatchで正規表現を使い、HTMLファイルの特定文字列を取り出します。</p>
<p>例<br>codeはコードブロックを意味します。このcodeを使って探し、その中をエスケープします。</p>
<marquee>;<br><h1>ここはエスケープしない</h1><br>code<br>  <h1>ここのタグはエスケープしたい</h1><br>code<br>;</marquee>

<p>上のコードをまずhtml_file変数に格納するとして、matchでcode~codeを探します。<br>gsubだと変換するための引数が必要になるため、単純に特定の文字列を抜き出すためにはmatchを使います。</p>
<marquee>;<br>match_html = html_file.match(/code<br>;</marquee>

<p>(a|b)はaまたはbを探します。今回は改行・空白も検索対象に入れたいため、\s(空白文字)と\S(空白文字以外)を(\s|\S)とすることでcode~code間の空白・改行を含む文字列を検索対象にしています。<br>アスタリスクハテナは直前の表現(今回は(\s|\S))の0回以上の繰り返しを意味するので、空白・改行を含む文字列が何文字あっても、それを正規表現で捉えることができます。</p>
<p>上の正規表現を用いることで</p>
<marquee>;<br>code<br>  <h1>ここは置き換えたい</h1><br>code<br>;</marquee>

<p>この部分を取得できます。これをgsubで置き換えます。<br>気を付けるのはmatchが返すのはMatchDataオブジェクトなので、.to_sでStringに置き換えてからgsubをします。</p>
<marquee>;<br>rewrite_html_escape_char = match_html.to_s.gsub()<br>;</marquee>

<p>gsubの正規表現の詳しい説明は割愛しますが、マッチした文字を第二引数でハッシュで指定すると、それを置き換えることができます。</p>
<p>ここまでは一致した文字列を抜き出し、その中の文字列を置き換えましたが、それをHTMLファイルに適用します。<br>今度はgsubでhtml_fileに対してcode~codeを探し、それを丸々rewrite_html_escape_charに書き換えます。</p>
<p>一番最初のmatchで行ったのと同じ正規表現を使って、今度はgsub!でhtml_fileに対してcode~codeを探し、それを丸々rewrite_html_escape_charに書き換えます。</p>
<marquee>;<br>html_file.gsub!(, rewrite_html_escape_char)<br>;</marquee>

<p>ここまでやって初めて書き換えが完了します。</p>
